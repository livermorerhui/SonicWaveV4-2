# SonicWave V4 – 关键用例检查清单

本清单用于在重构和整理仓库后，验证**现有业务行为没有被破坏**。  
每次完成一个 Phase 或较大改动，都建议至少手工执行这些用例。

---

## 1. 振动会话域

### 用例 1-1：在专家模式下执行一次振动会话

- 步骤：
  1. 启动 APP，确保处于在线模式（或当前预期模式）。
  2. 登录用户（如有必要）。
  3. 选择一个已有客户。
  4. 进入专家模式，选择一个专家预设方案。
  5. 点击“开始”执行振动会话，等待一段时间后点击“停止”。
- 预期结果：
  - 硬件设备按预设频率、强度震动。
  - 界面显示的参数与预设一致。
  - 会话可以正常开始和停止，中途无异常报错。

### 用例 1-2：将专家模式另存为自设模式并执行

- 步骤：
  1. 进入专家模式，选择某个方案。
  2. 使用“另存为自设模式”的功能，为当前客户保存一份自设模式。
  3. 进入自设模式列表，找到刚刚保存的模式。
  4. 执行该自设模式的振动会话。
- 预期结果：
  - 新自设模式在列表中可见，并与原专家模式匹配。
  - 执行时振动参数正确。
  - 会话结束后，记录与专家模式执行一致的行为日志（如果有）。

### 用例 1-3：离线模式下检查正弦波输出

- 步骤：
  1. 将 APP 切换到离线模式。
  2. 选择一个本地客户。
  3. 选择某个模式（自选/专家/自设），配置频率、强度、时长。
  4. 打开正弦波声音开关（如有），执行一次会话。
- 预期结果：
  - 在无硬件设备的情况下，APP 仍能正常执行逻辑。
  - 声音或模拟输出与配置参数一致。
  - 不发生崩溃或异常提示。

---

## 2. 客户与账户域

### 用例 2-1：用户注册与首次登录

- 步骤：
  1. 在 APP 中进入注册页面。
  2. 填写合法账号信息，完成注册。
  3. 使用新账号登录。
- 预期结果：
  - 注册成功，不出现重复或错误提示（除非测试重复注册）。
  - 登录成功后，APP 显示为“已登录”状态，用户信息正确。

### 用例 2-2：在线模式下新增客户

- 步骤：
  1. 使用已有账号登录 APP。
  2. 进入客户管理界面。
  3. 新增一个客户，填写必要信息并保存。
- 预期结果：
  - 新客户出现在客户列表中。
  - 再次打开 APP 或重新登录时，该客户仍然存在（表示已同步到服务器）。

### 用例 2-3：离线模式下新增客户

- 步骤：
  1. 切换到离线模式。
  2. 新增一个客户。
  3. 若有同步逻辑，在恢复在线模式后检查该客户是否能正常使用。
- 预期结果：
  - 离线模式下可以新增客户，不报错。
  - 客户在本地可见，用于离线会话。
  - 若设计支持同步，则在恢复在线后客户可正常参与在线会话。

---

## 3. 遥测与审计域

### 用例 3-1：APP 启动上报

- 步骤：
  1. 关闭 APP。
  2. 再次启动 APP。
  3. 观察后端日志或数据库记录（如果有调试入口）。
- 预期结果：
  - 后端收到一条启动事件，包括设备信息、IP、启动时间等字段。
  - 未出现重复、字段缺失或严重错误日志。

### 用例 3-2：APP 在线心跳

- 步骤：
  1. 启动 APP 并保持在前台运行一段时间。
  2. 在这一段时间内不要关闭 APP。
  3. 观察后端的心跳数据记录（或日志）。
- 预期结果：
  - 心跳数据按预期间隔写入（例如每 N 秒/分钟）。
  - 未出现异常报错或心跳异常中断。

### 用例 3-3：用户操作日志记录

- 步骤：
  1. 登录用户。
  2. 选择客户并执行一次振动会话（参考 1-1 或 1-2）。
  3. 在会话开始和结束后，检查后端操作日志。
- 预期结果：
  - 后端操作日志中包含这次会话记录。
  - 日志字段至少包括：用户、客户、频率、强度、时长、开始时间、停止时间。

---

## 4. 媒体播放域

### 用例 4-1：播放本地音乐

- 步骤：
  1. 启动 APP，进入音乐播放界面。
  2. 扫描或展示本地音乐列表。
  3. 选择一首音乐并播放、暂停、继续播放。
- 预期结果：
  - 音乐能够正常播放和暂停。
  - UI 播放状态与实际播放状态一致。
  - 不影响振动会话和其他功能的正常使用。

### 用例 4-2：在线音乐下载并播放

- 步骤：
  1. 启动 APP，并使用已有账号登录（确保具备访问在线音频的权限）。
  2. 在音乐界面中选择一首未缓存的在线音乐（例如标记为“云端”或“可下载”）。
  3. 触发“下载并播放”操作，APP 通过携带授权信息（如 Token）向服务器请求该音频。
  4. 下载完成后，APP 调用内部的列表刷新逻辑（例如 loadMusic()），将音频写入本地文件目录，并更新本地音乐列表。
  5. 在断网之前，确认该音乐已经出现在本地音乐列表中，并可以被选中播放。
  6. 关闭网络，尝试再次播放该音乐。
- 预期结果：
  - 下载过程中如网络错误，APP 给出明确的错误提示，不影响已有本地音乐播放。
  - 下载成功后，播放列表刷新完成，新下载的音乐在列表中可见，并可在有网状态下正常播放。
  - 关闭网络后，已下载的音乐仍然可以播放，证明缓存和列表刷新都已生效。

---

## 5. 基础设施与配置域

### 用例 5-1：在线/离线模式切换

- 步骤：
  1. 在 APP 中切换运行模式（在线 → 离线 → 在线）。
  2. 在不同模式下执行上述用例（至少覆盖 1-3, 2-3）。
- 预期结果：
  - 模式切换不会导致崩溃。
  - 离线模式下不依赖服务器也能完成核心操作。
  - 恢复在线模式后，各类功能恢复正常。

### 用例 5-2：后台全体功能开关

- 步骤：
  1. 在管理端 Web 中，修改某个全体功能开关（例如关闭某项敏感功能）。
  2. 重新打开 APP 或刷新配置。
  3. 在 APP 中尝试使用被关闭的功能。
- 预期结果：
  - 被关闭的功能在 APP 中不可用或有限制提示。
  - 未关闭的功能保持正常。

### 用例 5-3：后台控制消息生效（离线模式管控）

- 步骤：
  1. 启动 APP，并保证其与后端控制通道（例如 WebSocket）成功建立连接。
  2. 将 APP 切换到离线模式，或者处于“可进入离线模式”的状态。
  3. 在管理端 Web 中，针对当前设备下发一条与离线模式相关的控制指令，例如：
     - 允许进入离线模式；
     - 禁止进入离线模式；
     - 下发离线模式剩余时间或强制退出倒计时。
  4. 观察 APP 的界面和状态变化。
- 预期结果：
  - 控制通道连接正常时，APP 能够在合理时间内（例如数秒内）接收到该指令。
  - 对于“允许/禁止离线模式”的指令：
    - 允许时，APP 可以按原设计进入离线模式；
    - 禁止时，APP 拒绝进入离线模式，并给出合理提示（如有设计）。
  - 对于“强制退出离线模式/倒计时”的指令：
    - APP 能够正确展示剩余时间（如有 UI），在倒计时结束后自动退出离线模式。
  - 对应的状态变化有明确的界面反馈或日志记录，便于后续排查。
  - 当前实现中，如果后台发送非离线模式相关的控制指令（如任意运行模式切换或其他功能开关），这些指令不会生效；本用例仅验证离线模式相关控制能力。
